(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[515],{5923:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/post/[slug]",function(){return s(299)}])},299:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSP:function(){return m},default:function(){return p}});var n=s(1549),a=s(9650),o=s.n(a),r=s(3394),c=s(4194),i=s(1612),l=s(4330);let d=["LIKE","LOVE","CLAP","WOW"];function u(e){let{postId:t,initialCounts:s}=e,{accessToken:a}=(0,i.a)(),[o,l]=(0,c.useState)(()=>s||{}),[u,m]=(0,c.useState)(null);async function p(e){if(a){m(e),l(t=>({...t,[e]:(t[e]||0)+1}));try{await fetch("".concat(r.T,"/graphql"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({query:"mutation($id:ID!,$t:String!){ react(postId:$id,type:$t) }",variables:{id:t,t:e}})})}catch(t){l(t=>({...t,[e]:Math.max(0,(t[e]||1)-1)}))}finally{m(null)}}}return(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 mt-4",children:[d.map(e=>(0,n.jsxs)("button",{disabled:!a||u===e,onClick:()=>p(e),className:"px-3 py-1 rounded-full border text-xs font-medium bg-white dark:bg-slate-800 hover:bg-brand-50 dark:hover:bg-slate-700 transition flex items-center gap-1 disabled:opacity-40",children:[(0,n.jsx)("span",{children:function(e){switch(e){case"LOVE":return"\uD83D\uDC9C";case"CLAP":return"\uD83D\uDC4F";case"WOW":return"\uD83E\uDD2F";default:return"\uD83D\uDC4D"}}(e)}),(0,n.jsx)("span",{children:e.toLowerCase()}),(0,n.jsx)("span",{className:"text-brand-600 font-semibold",children:o[e]||0})]},e)),!a&&(0,n.jsx)("span",{className:"text-xs text-gray-500",children:"Login to react"})]})}var m=!0;function p(e){var t;let{post:s}=e,{accessToken:a,fetchWithAuth:d}=(0,i.a)(),m=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";"success"===t?l.Am.success(e):"error"===t?l.Am.error(e):(0,l.Am)(e)},[p,h]=(0,c.useState)(s.comments||[]),[x,f]=(0,c.useState)(""),[j,b]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{fetch("".concat(r.T,"/api/posts/").concat(s.id,"/comments")).then(e=>e.json()).then(h);let e=r.T.startsWith("https")?"wss":"ws",t=r.T.replace(/^https?:\/\//,""),n=new WebSocket("".concat(e,"://").concat(t,"/ws/posts/").concat(s.id,"/comments"));return n.onmessage=e=>{try{let t=JSON.parse(e.data);"comment"===t.type&&h(e=>[...e,t.payload])}catch(e){}},()=>n.close()},[s.id]),s)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o(),{children:[(0,n.jsxs)("title",{children:[s.title," - ChronicleX"]}),(0,n.jsx)("meta",{name:"description",content:s.content.slice(0,150)})]}),(0,n.jsxs)("article",{className:"max-w-3xl mx-auto p-4 prose dark:prose-invert",children:[(0,n.jsx)("h1",{children:s.title}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["by ",s.author.username]}),(0,n.jsx)(u,{postId:s.id,initialCounts:s.reactionCounts}),(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:null!==(t=s.rendered)&&void 0!==t?t:s.content}}),(0,n.jsxs)("section",{className:"mt-8",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Comments"}),a?(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x.trim()){b(!0);try{let e=await d("".concat(r.T,"/api/posts/").concat(s.id,"/comments"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:x})});if(e.ok){let t=await e.json();h(e=>[...e,t]),f(""),m("Comment posted!","success")}else m("Failed to post comment","error")}catch(e){m("Failed to post comment","error")}finally{b(!1)}}},className:"mb-6 space-y-2",children:[(0,n.jsx)("textarea",{value:x,onChange:e=>f(e.target.value),placeholder:"Add a comment",rows:3,className:"w-full rounded border p-2 text-sm focus:outline-none focus:ring-2 focus:ring-brand-500"}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("button",{disabled:j||!x.trim(),className:"btn px-3 py-1.5 text-xs",children:j?"Posting...":"Post Comment"})})]}):(0,n.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Login to add a comment."}),(0,n.jsx)("ul",{className:"space-y-2",children:p.map(e=>(0,n.jsx)("li",{className:"border p-2 rounded",children:e.content},e.id))})]})]})]}):(0,n.jsx)("p",{children:"Not found"})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=5923)}),_N_E=e.O()}]);