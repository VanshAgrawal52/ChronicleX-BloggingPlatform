(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{6300:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/create-post",function(){return a(7041)}])},7041:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var r=a(1549),s=a(4194),n=a(9650),o=a.n(n),l=a(3394),i=a(4330);function c(){let[e,t]=(0,s.useState)(""),[a,n]=(0,s.useState)(""),[c,d]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";"success"===t?i.Am.success(e):"error"===t?i.Am.error(e):(0,i.Am)(e)};(0,s.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("toast");if(t){let a="success"===t||"error"===t||"info"===t?t:"info";p("Toast test: ".concat(a),a),e.delete("toast");let r="".concat(window.location.pathname).concat(e.toString()?"?".concat(e.toString()):"");window.history.replaceState({},"",r)}},[]);let[f,m]=(0,s.useState)(null);async function w(t){t.preventDefault(),h("Saving...");let r=localStorage.getItem("accessToken");try{let t=await fetch("".concat(l.T,"/api/posts"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({title:e,content:a,tags:c.split(",").map(e=>e.trim()).filter(Boolean)})});if(!t.ok){let e=await t.text();h("Failed"),p("Post creation failed: ".concat(e||t.status),"error");return}let s=await t.json();m(s.id),localStorage.removeItem("draft:new"),h("Created (unpublished)"),p("Draft created! \uD83C\uDF89 Now publish it.","success")}catch(e){h("Failed"),p("Post creation failed: network error","error")}}return(0,s.useEffect)(()=>{let e=localStorage.getItem("draft:new");if(e){let a=JSON.parse(e);t(a.title||""),n(a.content||""),d(a.tags||"")}},[]),(0,s.useEffect)(()=>{let t=setTimeout(()=>{localStorage.setItem("draft:new",JSON.stringify({title:e,content:a,tags:c}))},1e3);return()=>clearTimeout(t)},[e,a,c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o(),{children:(0,r.jsx)("title",{children:"Create Post - ChronicleX"})}),(0,r.jsxs)("main",{className:"max-w-2xl mx-auto p-8 space-y-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Create Post"}),(0,r.jsx)("div",{className:"text-xs text-gray-500 flex gap-3",children:(0,r.jsx)("button",{type:"button",className:"btn-outline px-2 py-1",onClick:()=>{t("10 Practical TypeScript Tips for React Developers"),d("typescript,react,patterns"),n("# Why TypeScript in React\n\nType safety and refactorability.\n\n## Tips\n- Use discriminated unions\n- Narrow with in-operator\n- Model async with Result<T,E>\n\n## Example\n\n`type State = { kind: 'idle' } | { kind: 'loading' } | { kind: 'error'; error: string } | { kind: 'success'; data: T }`;"),p("Example filled","info")},children:"Use example"})}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4 card p-4",children:[(0,r.jsx)("input",{className:"w-full p-2 rounded bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700",placeholder:"Title",value:e,onChange:e=>t(e.target.value)}),(0,r.jsx)("textarea",{className:"w-full p-2 h-64 rounded bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700",placeholder:"Content (Markdown supported)",value:a,onChange:e=>n(e.target.value)}),(0,r.jsx)("input",{className:"w-full p-2 rounded bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700",placeholder:"Tags (comma separated)",value:c,onChange:e=>d(e.target.value)}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("button",{className:"btn",children:"Publish"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:'Creates a draft first; then click "Publish Now".'})]})]}),f&&(0,r.jsxs)("div",{className:"flex gap-3 items-center mt-2",children:[(0,r.jsx)("button",{onClick:async()=>{let e=localStorage.getItem("accessToken");try{let t=await fetch("".concat(l.T,"/api/posts/").concat(f,"/publish"),{method:"POST",headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok){p("Publish failed: ".concat(t.status),"error");return}let a=await t.json();p("Post published! \uD83D\uDE80","success"),window.location.href="/post/".concat(a.slug)}catch(e){p("Publish failed: network error","error")}},className:"btn text-sm",children:"Publish Now"}),(0,r.jsx)("button",{onClick:()=>{f&&(window.location.href="/post/".concat(f))},className:"text-xs underline",children:"View Raw (might 404 until published)"})]}),u&&(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:u})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6300)}),_N_E=e.O()}]);